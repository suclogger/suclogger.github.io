<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/image/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/image/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/image/favicon.png">
  <link rel="mask-icon" href="/image/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://suclogger.me').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="用于我司内部分享会，主要结合做过的项目简单介绍一下常用的爬虫模式。 前言什么是爬虫？  网络蜘蛛  关于爬虫是否合法的讨论？  用爬虫抓取数据，这样的行为是否合法  比较知名的开源的爬虫主要包括：JAVA : Webmagic，WebCollector，Crawler4jPYTHON :   Scrapy 简单的爬虫简单的网络爬虫可以只是遍历一个存放URL的集合并通过HttpClient发送网络">
<meta name="keywords" content="craw,webmagic">
<meta property="og:type" content="article">
<meta property="og:title" content="从webmagic着手浅析JAVA爬虫">
<meta property="og:url" content="https://suclogger.me/从webmagic着手浅析JAVA爬虫/index.html">
<meta property="og:site_name" content="Suclogger">
<meta property="og:description" content="用于我司内部分享会，主要结合做过的项目简单介绍一下常用的爬虫模式。 前言什么是爬虫？  网络蜘蛛  关于爬虫是否合法的讨论？  用爬虫抓取数据，这样的行为是否合法  比较知名的开源的爬虫主要包括：JAVA : Webmagic，WebCollector，Crawler4jPYTHON :   Scrapy 简单的爬虫简单的网络爬虫可以只是遍历一个存放URL的集合并通过HttpClient发送网络">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20上午9.33.jpeg">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20上午11.16.jpeg">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20下午5.00.jpeg">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20下午5.04.jpeg">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20下午5.06.jpeg?r=42">
<meta property="og:image" content="https://suclogger.me/image/2016-05-18%20at%20下午5.07.jpeg?r=56">
<meta property="og:image" content="https://suclogger.me/image/2016-05-20%2016-26-24.jpg?f=1">
<meta property="og:image" content="https://suclogger.me/image/2016-05-20%2016-27-15.jpg?f=2">
<meta property="og:image" content="https://suclogger.me/image/2016-05-20%2017-19-29.jpg?r=26">
<meta property="og:updated_time" content="2018-04-23T14:07:35.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从webmagic着手浅析JAVA爬虫">
<meta name="twitter:description" content="用于我司内部分享会，主要结合做过的项目简单介绍一下常用的爬虫模式。 前言什么是爬虫？  网络蜘蛛  关于爬虫是否合法的讨论？  用爬虫抓取数据，这样的行为是否合法  比较知名的开源的爬虫主要包括：JAVA : Webmagic，WebCollector，Crawler4jPYTHON :   Scrapy 简单的爬虫简单的网络爬虫可以只是遍历一个存放URL的集合并通过HttpClient发送网络">
<meta name="twitter:image" content="https://suclogger.me/image/2016-05-18%20at%20上午9.33.jpeg">

<link rel="canonical" href="https://suclogger.me/从webmagic着手浅析JAVA爬虫/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>从webmagic着手浅析JAVA爬虫 | Suclogger</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Suclogger</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">莆放</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>Sitemap</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://suclogger.me/从webmagic着手浅析JAVA爬虫/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/avatar.png">
      <meta itemprop="name" content="Suclogger">
      <meta itemprop="description" content="人生如逆旅，我亦是行人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Suclogger">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          从webmagic着手浅析JAVA爬虫
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-05-17 11:41:07" itemprop="dateCreated datePublished" datetime="2016-05-17T11:41:07+08:00">2016-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-04-23 22:07:35" itemprop="dateModified" datetime="2018-04-23T22:07:35+08:00">2018-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/爬虫/" itemprop="url" rel="index">
                    <span itemprop="name">爬虫</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/从webmagic着手浅析JAVA爬虫/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="从webmagic着手浅析JAVA爬虫/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <!-- abstract -->
<p>用于我司内部分享会，主要结合做过的项目简单介绍一下常用的爬虫模式。<br><!-- 开始正文 --></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>什么是爬虫？</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E8%9C%98%E8%9B%9B" target="_blank" rel="noopener">网络蜘蛛</a></p>
</blockquote>
<p>关于爬虫是否合法的讨论？</p>
<blockquote>
<p><a href="https://www.v2ex.com/t/268607" target="_blank" rel="noopener">用爬虫抓取数据，这样的行为是否合法</a></p>
</blockquote>
<p>比较知名的开源的爬虫主要包括：<br>JAVA : <a href="https://github.com/code4craft/webmagic" title="Webmagic" target="_blank" rel="noopener">Webmagic</a>，<a href="https://github.com/CrawlScript/WebCollector" title="WebCollector" target="_blank" rel="noopener">WebCollector</a>，<a href="https://github.com/yasserg/crawler4j" title="Crawler4j" target="_blank" rel="noopener">Crawler4j</a><br>PYTHON :  <a href="https://github.com/scrapy/scrapy" title="Scrapy" target="_blank" rel="noopener"> Scrapy</a></p>
<h2 id="简单的爬虫"><a href="#简单的爬虫" class="headerlink" title="简单的爬虫"></a>简单的爬虫</h2><p><code>简单的网络爬虫</code>可以只是遍历一个存放URL的集合并通过<code>HttpClient</code>发送网络请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">CloseableHttpClient httpclient = HttpClients.createDefault();</span><br><span class="line">try &#123;</span><br><span class="line">    HttpGet httpget = new HttpGet(&quot;http://httpbin.org/&quot;);</span><br><span class="line">    ResponseHandler&lt;String&gt; responseHandler = new ResponseHandler&lt;String&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public String handleResponse( HttpResponse response) throws IOException &#123;</span><br><span class="line">            int status = response.getStatusLine().getStatusCode();</span><br><span class="line">            if (status &gt;= 200 &amp;&amp; status &lt; 300) &#123;</span><br><span class="line">                HttpEntity entity = response.getEntity();</span><br><span class="line">                return entity != null ? EntityUtils.toString(entity) : null;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    String responseBody = httpclient.execute(httpget, responseHandler);</span><br><span class="line">&#125; catch (IOException e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        httpclient.close();</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="好的爬虫"><a href="#好的爬虫" class="headerlink" title="好的爬虫"></a>好的爬虫</h2><p>一个<code>好的爬虫框架</code>相比简单的爬虫，应该包含了以下特性：</p>
<ol>
<li>支持多线程</li>
<li>支持代理</li>
<li>支持过滤重复URL</li>
<li>支持爬取ajax返回信息</li>
<li>支持爬取需要登录验证的网页信息（Cookie管理）</li>
<li>支持持久化保存爬取到的信息</li>
<li>支持错误处理（IP被封禁或者登录信息失效后的处理）</li>
<li>支持停止后从断点继续</li>
<li>准确，快速地抓取所需信息<br>为了给一个简单的爬虫整合这些特性，需要做一个简单的框架设计。</li>
</ol>
<h2 id="优雅的框架设计"><a href="#优雅的框架设计" class="headerlink" title="优雅的框架设计"></a>优雅的框架设计</h2><p><code>Scrapy</code>的框架：</p>
<p><img src="/image/2016-05-18 at 上午9.33.jpeg" alt="Scrapy Structure"></p>
<ul>
<li><code>Spider</code>创建<code>Request</code>，处理<code>Response</code>,生成<code>Items</code>和后续<code>Request</code>。</li>
<li><code>Items</code>是从Response中由抽取出的所需信息组合而成的一个个POJO。</li>
<li>Spider生成的<code>Items</code>经<code>process_item()</code>方法交由一系列的<code>Item Pipelines</code>进行处理。</li>
<li><code>Pipeline</code>处理<code>Items</code>，可以是保存到数据库，打印到控制台，提交给Elasticsearch等等。</li>
<li><code>Downloader</code>负责实际的下载行为，接收传入的Request请求，输出Response。</li>
</ul>
<p><code>Webmagic</code>的框架：<br><img src="/image/2016-05-18 at 上午11.16.jpeg" alt="webmagic structure"></p>
<p>Webmagic的框架设计大部分沿袭了Scrapy：</p>
<ul>
<li><code>Downloader</code>负责从互联网上下载页面，以便后续处理。WebMagic默认使用了Apache HttpClient作为下载工具。</li>
<li><code>PageProcessor</code> 负责解析页面，抽取有用信息，以及发现新的链接。</li>
<li><code>Scheduler</code>负责管理待抓取的URL，以及一些去重的工作。</li>
<li><code>Pipeline</code>负责抽取结果的处理，包括计算、持久化到文件、数据库等。<br><strong><code>Webmagic</code>很好的贯彻了<code>面向接口</code>的设计思想，我们可以很容易地对上述的组件进行自定义和扩展。</strong><br>更进一步，可以通过修改webmgic的源代码来满足我们的定制化需求。</li>
</ul>
<h2 id="储备知识"><a href="#储备知识" class="headerlink" title="储备知识"></a>储备知识</h2><h3 id="通过XPath获取页面元素"><a href="#通过XPath获取页面元素" class="headerlink" title="通过XPath获取页面元素"></a>通过XPath获取页面元素</h3><p>常见的从html页面获取元素的方式是通过<code>Jsoup</code>，它支持用<code>CSS Selector</code>方式选择DOM元素，也可过滤HTML文本。</p>
<blockquote>
<p>参见<code>renault</code>中Craw168.java的实现</p>
</blockquote>
<p>这里主要介绍通过Xpath语法获取页面元素。Xpath语法介绍请见：<a href="http://www.w3school.com.cn/xpath/" target="_blank" rel="noopener">Xpath语法</a><br>由于Jsoup暂不支持Xpath语法，webmagic中集成了<a href="https://github.com/code4craft/xsoup" target="_blank" rel="noopener">Xsoup</a>来实现对Xpath语法的支持。但是由于Xsoup项目疏于维护，对Xpath的语法支持不全，我个人给webmgic添加了<code>JsoupXpath</code>来支持<code>Xpath</code>语法。JsoupXpath项目地址：<a href="https://github.com/zhegexiaohuozi/JsoupXpath" target="_blank" rel="noopener">JsoupXpath</a></p>
<h4 id="在chrome中调试xpath"><a href="#在chrome中调试xpath" class="headerlink" title="在chrome中调试xpath"></a>在chrome中调试xpath</h4><p>通过 开发者工具-元素选择栏 可以快速获取所需元素的xpath路径：<br><img src="/image/2016-05-18 at 下午5.00.jpeg" alt="chrome xpath chose"></p>
<p>在console中可以使用<code>$x(&quot;XPath路径&quot;)</code>来定位xpath对应的元素：<br><img src="/image/2016-05-18 at 下午5.04.jpeg" alt="get element by xpath in chrome"></p>
<h4 id="在firefox中调试xpath"><a href="#在firefox中调试xpath" class="headerlink" title="在firefox中调试xpath"></a>在firefox中调试xpath</h4><p>通过安装插件<code>XPath Checker</code>来调试xpath：<br>查看：<br><img src="/image/2016-05-18 at 下午5.06.jpeg?r=42" alt="firefox xpath chose"><br>获取元素：<br><img src="/image/2016-05-18 at 下午5.07.jpeg?r=56" alt="get element by xpath in firefox"></p>
<h4 id="使用xpath需要遵循的几个原则"><a href="#使用xpath需要遵循的几个原则" class="headerlink" title="使用xpath需要遵循的几个原则"></a>使用xpath需要遵循的几个原则</h4><ol>
<li>避免使用数组的形式获取元素，如<code>//*[@id=&quot;myid&quot;]/div/div/div[1]/div[2]/div/div[1]/div[1]/a/img</code>。这种形式的xpath表达式是很脆弱的，因为页面的元素的排列很可能受到广告的插入，其他信息的存在与否而导致数组依赖的div的显示与否 等等因素的影响。通过chrome或者firefox自动获取的xpath通常是这种形式，要记得对得到的结果进行一定处理。<br>举个例子：<br>第一个页面上使用<code>li[9]</code>路径来获取页面上的<code>QQ</code>元素，但是第二页面中由于没有对应的元素，导致后面的元素使用了<code>li[9]</code>路径，这时候如果还用<code>li[9]</code>路径来获取页面上的<code>QQ</code>元素，就会得到错误的元素：<br><img src="/image/2016-05-20 16-26-24.jpg?f=1" alt>  <img src="/image/2016-05-20 16-27-15.jpg?f=2" alt></li>
<li>避免采用元素的<code>class</code>属性来获取元素，如<code>//div[@class=&quot;red&quot;]/a/img</code>。因为class通常用于控制页面元素的样式，一旦页面的样式风格发生变化，对应元素的class也极有可能发生变化。</li>
<li>元素的<code>id</code>属性通常是最为可靠的，如<code>//*[@id=&quot;more_info&quot;]//text()</code>。</li>
</ol>
<p>接下来就用一个简单的实例进入实战：</p>
<h2 id="一个简单的webmgic的例子"><a href="#一个简单的webmgic的例子" class="headerlink" title="一个简单的webmgic的例子"></a>一个简单的webmgic的例子</h2><h3 id="CaoLiuCraw"><a href="#CaoLiuCraw" class="headerlink" title="CaoLiuCraw"></a>CaoLiuCraw</h3><p>CaoLiuProcessor.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class CaoLiuProcessor implements PageProcessor &#123;</span><br><span class="line">    private Site site = Site.me()</span><br><span class="line">            .setUserAgent(&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36&quot;)</span><br><span class="line">            .setCharset(&quot;GBK&quot;).setDomain(&quot;cl.pclmm.org&quot;).setSleepTime(5000)</span><br><span class="line">            .setHttpProxy(new HttpHost(&quot;localhost&quot;,6152));</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void process(Page page) &#123;</span><br><span class="line">        String title = page.getHtml().selectDocument(new JsoupXpathSelector(&quot;//title/text()&quot;));</span><br><span class="line">        List&lt;String&gt; list = page.getHtml().selectDocumentForList(new JsoupXpathSelector(&quot;//div[@class=&apos;tpc_content do_not_catch&apos;]/descendant::input[@type=&apos;image&apos;]/@src&quot;));</span><br><span class="line">        page.putField(&quot;title&quot;, title);</span><br><span class="line">        page.putField(&quot;images&quot;, list);</span><br><span class="line">        Selectable links = page.getHtml().links();</span><br><span class="line">        List&lt;String&gt; targeturls = links.regex(&quot;http:\\/\\/cl\\.pclmm\\.org\\/htm_data\\/\\d+\\/\\d+\\/\\d+\\.html&quot;).all();</span><br><span class="line">        List&lt;String&gt; helpurls = links.regex(&quot;http:\\/\\/cl\\.pclmm\\.org\\/thread0806\\.php\\?fid=16&amp;search=&amp;page=\\d+&quot;).all();</span><br><span class="line">        page.addTargetRequests(helpurls);</span><br><span class="line">        page.addTargetRequests(targeturls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Site getSite() &#123;</span><br><span class="line">        return site;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws FileNotFoundException, UnsupportedEncodingException &#123;</span><br><span class="line">        Spider.create(new CaoLiuProcessor())</span><br><span class="line">//                .setScheduler(new FileCacheQueueScheduler(&quot;/Users/suclogger/MyWorkspace/caoliua&quot;))</span><br><span class="line">                .addUrl(&quot;http://cl.pclmm.org/thread0806.php?fid=16&amp;search=&amp;page=1&quot;)</span><br><span class="line">                .addPipeline(new CaoLiuPip())</span><br><span class="line">                .thread(2)</span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CaoLiuPip.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">public class CaoLiuPip implements Pipeline&#123;</span><br><span class="line">    private final static String path = &quot;/Users/suclogger/MyWorkspace/caoliu/&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void process(ResultItems resultItems, Task task) &#123;</span><br><span class="line">        String title = resultItems.get(&quot;title&quot;);</span><br><span class="line">        List&lt;String&gt; list = resultItems.get(&quot;images&quot;);</span><br><span class="line">        if(!StringUtils.isBlank(title) &amp;&amp; list.size() &gt; 0) &#123;</span><br><span class="line">            StringBuffer imgFileNameNewYuan =new StringBuffer(path)</span><br><span class="line">                    .append(title) //此处提取文件夹名，即之前采集的标题名</span><br><span class="line">                    .append(&quot;/&quot;);</span><br><span class="line">            //这里先判断文件夹名是否存在，不存在则建立相应文件夹</span><br><span class="line">            Path target = Paths.get(imgFileNameNewYuan.toString());</span><br><span class="line">            if(!Files.isReadable(target))&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Files.createDirectory(target);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    logger.error(&quot;folder exist &#123;&#125;&quot;, imgFileNameNewYuan.toString(),e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            for(int i=1;i&lt;list.size();i++)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    ThreadPoolFactory.getThreadPool().execute(new DownloadImg(imgFileNameNewYuan.toString(), title,list.get(i)));</span><br><span class="line">                &#125; catch (RejectedExecutionException e) &#123;</span><br><span class="line">                    logger.error(&quot;image thread too many, hold on for a minuet&quot;);</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(60000);</span><br><span class="line">                        // retry</span><br><span class="line">                        ThreadPoolFactory.getThreadPool().execute(new DownloadImg(imgFileNameNewYuan.toString(), title,list.get(i)));</span><br><span class="line">                    &#125; catch (Exception e1) &#123;</span><br><span class="line">                        logger.error(&quot;shit retry error. do nothing&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class DownloadImg implements Runnable&#123;</span><br><span class="line">        private final HttpHost proxy = new HttpHost(&quot;127.0.0.1&quot;, 6152, &quot;http&quot;);</span><br><span class="line"></span><br><span class="line">        String imgpath;</span><br><span class="line">        String title;</span><br><span class="line">        String link;</span><br><span class="line"></span><br><span class="line">        public DownloadImg(String imgpath, String title, String link) &#123;</span><br><span class="line">            this.imgpath = imgpath;</span><br><span class="line">            this.title = title;</span><br><span class="line">            this.link = link;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                String extName=com.google.common.io</span><br><span class="line">                        .Files.getFileExtension(link);</span><br><span class="line">                StringBuffer imgFileNameNew = new StringBuffer(imgpath)</span><br><span class="line">                        .append((link)</span><br><span class="line">                                .replaceAll(&quot;[\\pP‘’“”]&quot;, &quot;&quot;))</span><br><span class="line">                        .append(&quot;.&quot;)</span><br><span class="line">                        .append(extName);</span><br><span class="line"></span><br><span class="line">                //这里通过httpclient下载之前抓取到的图片网址，并放在对应的文件中</span><br><span class="line">                CloseableHttpClient httpclient = HttpClients.createDefault();</span><br><span class="line">                RequestConfig config = RequestConfig.custom()</span><br><span class="line">                        .setProxy(proxy)</span><br><span class="line">                        .build();</span><br><span class="line">                HttpGet httpget = new HttpGet(link);</span><br><span class="line">                httpget.setConfig(config);</span><br><span class="line">                HttpResponse response = httpclient.execute(httpget);</span><br><span class="line">                HttpEntity entity = response.getEntity();</span><br><span class="line">                InputStream in = entity.getContent();</span><br><span class="line">                File file = new File(imgFileNameNew.toString());</span><br><span class="line">                try &#123;</span><br><span class="line">                    FileOutputStream fout = new FileOutputStream(file);</span><br><span class="line">                    int l = -1;</span><br><span class="line">                    byte[] tmp = new byte[1024];</span><br><span class="line">                    while ((l = in.read(tmp)) != -1) &#123;</span><br><span class="line">                        fout.write(tmp,0,l);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fout.flush();</span><br><span class="line">                    fout.close();</span><br><span class="line">                    logger.info(&quot;save image : &#123;&#125;&quot;, link);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125;</span><br><span class="line">                httpclient.close();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                logger.error(&quot;fail saving image : &#123;&#125;&quot;,link);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="通过注解编写爬虫的例子"><a href="#通过注解编写爬虫的例子" class="headerlink" title="通过注解编写爬虫的例子"></a>通过注解编写爬虫的例子</h2><h3 id="EBookCraw"><a href="#EBookCraw" class="headerlink" title="EBookCraw"></a>EBookCraw</h3><p><code>EBookModel.java</code>（略去了get和set方法）:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">@TargetUrl(&quot;http:\\/\\/www.allitebooks.com\\/(?!read\\/read.php)*&quot;)</span><br><span class="line">@HelpUrl(&#123;&quot;http://www.allitebooks.com/\\/page\\/\\d+&quot;&#125;)</span><br><span class="line">public class EBookModel &#123;</span><br><span class="line">    @ExtractBy(value = &quot;//header[@class=&apos;entry-header&apos;]/h1[@class=&apos;single-title&apos;]/text()&quot;,notNull = true)</span><br><span class="line">    @Formatter(value = &quot;author is %s&quot;,formatter = EBookTitleFormatter.class)</span><br><span class="line">    private String title;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//header[@class=&apos;entry-header&apos;]/h4/text()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String brief;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//header[@class=&apos;entry-header&apos;]/div/div[@class*=&apos;entry-body-thumbnail&apos;]/a/img/@src&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String cover;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[1]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String author;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[2]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String isbn;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[3]/text()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String year;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[4]/text()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String pages;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[5]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String language;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl//dd[6]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String fileSize;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[7]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String fileFormat;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;book-detail&apos;]/dl/dd[8]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String category;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(value = &quot;//div[@class=&apos;entry-content&apos;]/allText()&quot;,type = ExtractBy.Type.JsoupXpath)</span><br><span class="line">    private String description;</span><br><span class="line"></span><br><span class="line">    @ExtractBy(&quot;//span[@class=&apos;download-links&apos;][1]/a/@href&quot;)</span><br><span class="line">    private String downloadLink;</span><br><span class="line"></span><br><span class="line">    @ExtractByUrl(&quot;http://www.allitebooks.com/([\\w-]+)&quot;)</span><br><span class="line">    private String url;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EBookPip.java:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class EBookPip implements PageModelPipeline &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private EBookAO eBookAO;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void process(Object o, Task task) &#123;</span><br><span class="line">        if(o instanceof EBookModel) &#123;</span><br><span class="line">            EBookModel model = (EBookModel) o;</span><br><span class="line">            EbookDO edo = new EbookDO();</span><br><span class="line">            edo.setTitle(model.getTitle());</span><br><span class="line">            edo.setAuthor(model.getAuthor());</span><br><span class="line">            edo.setBrief(model.getBrief());</span><br><span class="line">            edo.setCategory(model.getCategory());</span><br><span class="line">            edo.setCover(model.getCover());</span><br><span class="line">            edo.setDescription(model.getDescription());</span><br><span class="line">            edo.setDownloadLink(model.getDownloadLink());</span><br><span class="line">            edo.setFileFormat(model.getFileFormat());</span><br><span class="line">            edo.setFileSize(model.getFileSize());</span><br><span class="line">            edo.setIsbn(model.getIsbn());</span><br><span class="line">            edo.setLanguage(model.getLanguage());</span><br><span class="line">            edo.setYears(model.getYear());</span><br><span class="line">            if(!StringUtils.isBlank(model.getPages()) &amp;&amp; StringUtils.isNumeric(model.getPages())) &#123;</span><br><span class="line">                edo.setPages(Integer.valueOf(model.getPages()));</span><br><span class="line">            &#125;</span><br><span class="line">            edo.setUrl(model.getUrl());</span><br><span class="line">            try &#123;</span><br><span class="line">                eBookAO.save(edo);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="对一些特性的分析"><a href="#对一些特性的分析" class="headerlink" title="对一些特性的分析"></a>对一些特性的分析</h2><ul>
<li><p>多线程的支持<br>多线程的支持是通过一个可监控的<code>TheadPool</code>实现的，用法是通过<code>Spider.thread(N)</code>来开启N个线程。</p>
</li>
<li><p>代理的支持<br>下文 <code>应对网站的反爬措施</code> 部分中会展开。</p>
</li>
<li><p>过滤重复URL的支持<br>过滤是通过实现<code>DuplicateRemover</code>接口实现的，默认实现是使用内存中的一个<code>HashSet</code>集来存放已添加进爬取队列的网址。<br>扩展中还添加了<a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="noopener">布隆过滤器</a>的实现，适用于巨量网址的去重。</p>
</li>
<li><p>爬取ajax返回信息<br>通过采集页面链接，并将ajax链接放入爬取队列中可以实现。</p>
</li>
<li><p>支持爬取需要登录验证的网页信息（Cookie管理）<br><code>Scrapy</code>替我们托管了所有cookie操作，但是webmagic中没有实现。<br>通过<code>CookieProvider</code>管理Cookie。</p>
</li>
<li><p>持久信息的支持<br>如上面的<code>EBookCraw</code>例子，可以在PipeLine中添加数据持久化逻辑。</p>
</li>
<li><p>支持停止后从断点继续<br>采用<code>FileCacheQueueScheduler</code>来管理爬取链接，爬取中止后可以从文件中读取爬取进度。</p>
</li>
</ul>
<h2 id="应对网站的反爬措施"><a href="#应对网站的反爬措施" class="headerlink" title="应对网站的反爬措施"></a>应对网站的反爬措施</h2><p>主要有下面三个方面 ：</p>
<ol>
<li>使用webmagic集成的<code>ProxyPool</code>来管理Proxy</li>
<li>实现<code>CookieProvider</code>自定义管理Cookie</li>
<li>实现<code>ErrorDetector</code>自定义捕获错误</li>
</ol>
<h3 id="使用webmagic集成的ProxyPool来管理Proxy"><a href="#使用webmagic集成的ProxyPool来管理Proxy" class="headerlink" title="使用webmagic集成的ProxyPool来管理Proxy"></a>使用webmagic集成的<code>ProxyPool</code>来管理Proxy</h3><p><code>ProxyPool</code>维护了一个代理的有序队列，在每次请求完成后，通过请求的状态码设置当前使用的代理的优先级别返还到队列中，每次请求从队列中根据优先级别重新获取新的代理。<br>这种方式适用于手上有很多前向代理资源的爬虫，切换起来比较方便，有些情况下可能需要与切换Cookie相互配合使用。</p>
<h3 id="实现CookieProvider自定义管理Cookie"><a href="#实现CookieProvider自定义管理Cookie" class="headerlink" title="实现CookieProvider自定义管理Cookie"></a>实现<code>CookieProvider</code>自定义管理Cookie</h3><p>每次请求都会从<code>CookieProvider</code>中拿一个cookie放入本次请求头中，可以通过方法调用切换cookie。<br><strong>结合renault演示</strong></p>
<h2 id="增量抓取"><a href="#增量抓取" class="headerlink" title="增量抓取"></a>增量抓取</h2><p>通过实现<code>ExistDetector</code>接口，在抓取后续链接的时候调用<code>detect()</code>方法进行判断是否需要抓取该链接。<br><strong>结合renault演示</strong></p>
<h2 id="爬虫的运行监控"><a href="#爬虫的运行监控" class="headerlink" title="爬虫的运行监控"></a>爬虫的运行监控</h2><p>还在雏形阶段<br><img src="/image/2016-05-20 17-19-29.jpg?r=26" alt></p>
<p>参考：<a href="http://my.oschina.net/flashsword/blog/202889" target="_blank" rel="noopener">WebMagic Avalon设计草图</a></p>

    </div>

    
    
    
        <div class="reward-container">
  <div>加入星球与我交流</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/image/alipay.png" alt="Suclogger WeChat Pay">
        <p>WeChat Pay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/craw/" rel="tag"># craw</a>
              <a href="/tags/webmagic/" rel="tag"># webmagic</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/逆向解除TextNut内购限制/" rel="prev" title="逆向解除TextNut内购限制">
      <i class="fa fa-chevron-left"></i> 逆向解除TextNut内购限制
    </a></div>
      <div class="post-nav-item">
    <a href="/到底需不需要Manager层？/" rel="next" title="到底需不需要Manager层？">
      到底需不需要Manager层？ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单的爬虫"><span class="nav-number">2.</span> <span class="nav-text">简单的爬虫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#好的爬虫"><span class="nav-number">3.</span> <span class="nav-text">好的爬虫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优雅的框架设计"><span class="nav-number">4.</span> <span class="nav-text">优雅的框架设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#储备知识"><span class="nav-number">5.</span> <span class="nav-text">储备知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#通过XPath获取页面元素"><span class="nav-number">5.1.</span> <span class="nav-text">通过XPath获取页面元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在chrome中调试xpath"><span class="nav-number">5.1.1.</span> <span class="nav-text">在chrome中调试xpath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在firefox中调试xpath"><span class="nav-number">5.1.2.</span> <span class="nav-text">在firefox中调试xpath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用xpath需要遵循的几个原则"><span class="nav-number">5.1.3.</span> <span class="nav-text">使用xpath需要遵循的几个原则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个简单的webmgic的例子"><span class="nav-number">6.</span> <span class="nav-text">一个简单的webmgic的例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CaoLiuCraw"><span class="nav-number">6.1.</span> <span class="nav-text">CaoLiuCraw</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过注解编写爬虫的例子"><span class="nav-number">7.</span> <span class="nav-text">通过注解编写爬虫的例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EBookCraw"><span class="nav-number">7.1.</span> <span class="nav-text">EBookCraw</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对一些特性的分析"><span class="nav-number">8.</span> <span class="nav-text">对一些特性的分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应对网站的反爬措施"><span class="nav-number">9.</span> <span class="nav-text">应对网站的反爬措施</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用webmagic集成的ProxyPool来管理Proxy"><span class="nav-number">9.1.</span> <span class="nav-text">使用webmagic集成的ProxyPool来管理Proxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现CookieProvider自定义管理Cookie"><span class="nav-number">9.2.</span> <span class="nav-text">实现CookieProvider自定义管理Cookie</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增量抓取"><span class="nav-number">10.</span> <span class="nav-text">增量抓取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#爬虫的运行监控"><span class="nav-number">11.</span> <span class="nav-text">爬虫的运行监控</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Suclogger" src="/image/avatar.png">
  <p class="site-author-name" itemprop="name">Suclogger</p>
  <div class="site-description" itemprop="description">人生如逆旅，我亦是行人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/suclogger" title="GitHub → https://github.com/suclogger" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Suclogger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://suclogger.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://suclogger.me/从webmagic着手浅析JAVA爬虫/",
            identifier: "从webmagic着手浅析JAVA爬虫/",
            title: "从webmagic着手浅析JAVA爬虫"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://suclogger.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script>

</body>
</html>
