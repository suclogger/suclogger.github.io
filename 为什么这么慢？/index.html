<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="昨天差点引发了一个严重线上bug，以此为记。">
<meta name="keywords" content="elasticsearch,java">
<meta property="og:type" content="article">
<meta property="og:title" content="为什么这么慢？">
<meta property="og:url" content="https://suclogger.me/为什么这么慢？/index.html">
<meta property="og:site_name" content="Suclogger">
<meta property="og:description" content="昨天差点引发了一个严重线上bug，以此为记。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://suclogger.me/image/login.dawanju.net%20-%20SecureCRT%202017-06-08%2018-43-27.png">
<meta property="og:image" content="https://suclogger.me/image/login.dawanju.net%20-%20SecureCRT%202017-06-08%2018-42-47.png">
<meta property="og:image" content="https://suclogger.me/image/RDS管理控制台%202017-06-08%2020-04-51.png">
<meta property="og:image" content="https://suclogger.me/image/2017-06-09-17-54-16.jpg">
<meta property="og:image" content="https://suclogger.me/image/2017-06-09-18-26-34.jpg">
<meta property="og:image" content="https://suclogger.me/image/2017-06-09-18-27-35.jpg">
<meta property="og:image" content="https://suclogger.me/image/@iZ23qcuujszZ::tmp%202017-06-09%2016-16-37.png">
<meta property="og:image" content="https://suclogger.me/image/search_load.png">
<meta property="og:updated_time" content="2017-06-09T10:42:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="为什么这么慢？">
<meta name="twitter:description" content="昨天差点引发了一个严重线上bug，以此为记。">
<meta name="twitter:image" content="https://suclogger.me/image/login.dawanju.net%20-%20SecureCRT%202017-06-08%2018-43-27.png">






  <link rel="canonical" href="https://suclogger.me/为什么这么慢？/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>为什么这么慢？ | Suclogger</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Suclogger</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">莆放</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories" rel="section">Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about" rel="section">About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">Sitemap</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://suclogger.me/为什么这么慢？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Suclogger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Suclogger">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">为什么这么慢？
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-06-09 17:26:33 / Modified: 18:42:38" itemprop="dateCreated datePublished" datetime="2017-06-09T17:26:33+08:00">2017-06-09</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>昨天差点引发了一个严重线上bug，以此为记。<br><a id="more"></a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>我们现在采用的是logstash的jdbc插件同步mysql的数据。<br>这次上线的功能需要多关联一张表查询数据进入索引，直接体现在logstash jdbc配置文件中定义的SQL多了一个left join。</p>
<h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>应用发布之后，tomcat启动耗时很长时间，很<strong>慢</strong>。<br>进入应用，索引重建后依照惯例执行了全量索引的logstash脚本，但是索引迟迟没有创建成功，很<strong>慢</strong>。</p>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><h3 id="Tomcat启动慢"><a href="#Tomcat启动慢" class="headerlink" title="Tomcat启动慢"></a>Tomcat启动慢</h3><p><img src="/image/login.dawanju.net - SecureCRT 2017-06-08 18-43-27.png" alt=""><br>从日志中找到罪魁祸首：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Creation of SecureRandom<span class="built_in"> instance </span><span class="keyword">for</span> session ID generation using [SHA1PRNG] took [*,*] milliseconds.</span><br></pre></td></tr></table></figure></p>
<p>当时因为一次打不开页面，做了多次刷新操作，生成session ID的过程一只阻塞到完成所有session ID的创建，耗时接近4分钟。<br><a href="https://wiki.apache.org/tomcat/HowTo/FasterStartUp#Entropy_Source" target="_blank" rel="noopener">Tomcat官方文档</a>也给出了说明：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Tomcat 7+ heavily relies on SecureRandom class <span class="keyword">to</span> provide random values <span class="keyword">for</span> its session ids <span class="keyword">and</span> <span class="keyword">in</span> other places. Depending on your JRE it can cause delays during startup <span class="keyword">if</span> entropy source that is used <span class="keyword">to</span> initialize SecureRandom is short of entropy. You will see <span class="builtin-name">warning</span> <span class="keyword">in</span> the logs when this happens, e.g.:</span><br><span class="line"></span><br><span class="line">&lt;DATE&gt; org.apache.catalina.util.SessionIdGenerator createSecureRandom</span><br><span class="line">INFO: Creation of SecureRandom<span class="built_in"> instance </span><span class="keyword">for</span> session ID generation using [SHA1PRNG] took [5172] milliseconds.</span><br><span class="line">There is a way <span class="keyword">to</span> configure JRE <span class="keyword">to</span> use a non-blocking entropy source by setting the following<span class="built_in"> system </span>property: -Djava.security.<span class="attribute">egd</span>=file:/dev/./urandom</span><br><span class="line"></span><br><span class="line">Note the <span class="string">"/./"</span> characters <span class="keyword">in</span> the value. They are needed <span class="keyword">to</span> work around known Oracle JRE bug #6202721. See also JDK Enhancement<span class="built_in"> Proposal </span>123. It is known that implementation of SecureRandom was improved <span class="keyword">in</span> Java 8 onwards.</span><br><span class="line"></span><br><span class="line">Also<span class="built_in"> note </span>that replacing the blocking entropy source (/dev/random) with a non-blocking one actually reduces security because you are getting less-random data. <span class="keyword">If</span> you have a problem generating entropy on your<span class="built_in"> server </span>(which is common), consider looking into entropy-generating<span class="built_in"> hardware </span>products such as <span class="string">"EntropyKey"</span>.</span><br></pre></td></tr></table></figure></p>
<p>Tomcat也给出了解决方案：<strong>在启动的jvm参数中加入<code>-Djava.security.egd=file:/dev/./urandom</code></strong>，同时也警告说这种方式存在一些安全隐患。<br>添加jvm参数后启动就正常了：<br><img src="/image/login.dawanju.net - SecureCRT 2017-06-08 18-42-47.png" alt=""></p>
<h3 id="创建索引慢：数据库"><a href="#创建索引慢：数据库" class="headerlink" title="创建索引慢：数据库"></a>创建索引慢：数据库</h3><p>怀疑因为多关联了一张表导致数据库查询耗时增加，进入RDS监控查看发现CPU出现峰值：<br><img src="/image/RDS管理控制台 2017-06-08 20-04-51.png" alt=""></p>
<p>结合之前RDS出现CPU飙升阿里工程师给出的解释：</p>
<blockquote>
<p>CPU高主要是由于这些慢查询导致，建议您先优化下这慢查询再观察下。</p>
</blockquote>
<p>（小插曲，惊觉配置文件中写入的数据库地址被从备库误写为主库）<br>第一时间通过mysql的<code>show processlist</code>找到创建索引的SQL进程执行<code>kill</code>，保障其他业务不受影响。<br>然后，进入慢日志查询中，发现果然是创建索引的SQL执行时间超长，这条SQL执行时间长达492s：<br><img src="/image/2017-06-09-17-54-16.jpg" alt=""><br>接着，分析sql，怀疑新关联的表没有为关联的字段创建索引，马上在这个字段上创建索引。<br>随后创建索引，输出以下日志：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">2017-06-08T19:36:22,802</span>][<span class="symbol">INFO </span>][<span class="string">logstash.pipeline        </span>] Starting pipeline &#123;"id"=&gt;"main", "pipeline.workers"=&gt;2, "pipeline.batch.size"=&gt;125, "pipeline.batch.delay"=&gt;5</span><br><span class="line">[<span class="string">2017-06-08T19:36:22,850</span>][<span class="symbol">INFO </span>][<span class="string">logstash.pipeline        </span>] Pipeline main started</span><br><span class="line">[<span class="string">2017-06-08T19:36:22,920</span>][<span class="symbol">INFO </span>][<span class="string">logstash.agent           </span>] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</span><br><span class="line">[<span class="string">2017-06-08T19:36:32,053</span>][<span class="symbol">INFO </span>][<span class="string">logstash.inputs.jdbc     </span>] (9.767000s) SELECT car.car<span class="emphasis">_id AS car_</span>id,</span><br><span class="line">...</span><br><span class="line">[<span class="string">2017-06-08T19:42:51,136</span>][<span class="symbol">WARN </span>][<span class="string">logstash.agent           </span>] stopping pipeline &#123;:id=&gt;"main"&#125;</span><br></pre></td></tr></table></figure></p>
<p>看到logstash的日志中，执行SQL的时间为<code>9.7s</code>，虽然时间略长，但是考虑到是多表关联+全表扫描，所以暂且任务数据库的问题已经处理完成。<br>但是还是没解决索引创建为什么这么慢的问题。<br>单次全量耗时为6分20s，系统资源冗余较多。<br><img src="/image/2017-06-09-18-26-34.jpg" alt=""></p>
<h3 id="创建索引慢：EL"><a href="#创建索引慢：EL" class="headerlink" title="创建索引慢：EL"></a>创建索引慢：EL</h3><p>通过上面的日志输出看到logstash采用的是默认配置：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pipeline<span class="selector-class">.workers</span> =&gt; <span class="number">2</span> <span class="comment">// 并行的线程数</span></span><br><span class="line">pipeline<span class="selector-class">.batch</span><span class="selector-class">.size</span>=&gt;<span class="number">125</span> <span class="comment">// 单个线程单次处理的最大索引数</span></span><br><span class="line">pipeline<span class="selector-class">.batch</span><span class="selector-class">.delay</span>=&gt;<span class="number">5</span> <span class="comment">// 如果在这里定义的时间内没有达到最大索引数，也执行提交</span></span><br></pre></td></tr></table></figure></p>
<p>更多配置项参见<a href="https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html" target="_blank" rel="noopener">官网文档</a>。</p>
<p>尝试更改配置为：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pipeline<span class="selector-class">.workers</span> =&gt; <span class="number">4</span> <span class="comment">// 2*cpu</span></span><br><span class="line">pipeline<span class="selector-class">.batch</span><span class="selector-class">.size</span>=&gt;<span class="number">20000</span></span><br><span class="line">pipeline<span class="selector-class">.batch</span><span class="selector-class">.delay</span>=&gt;<span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>日志如下：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">2017-06-09T15:11:09,088</span>][<span class="symbol">INFO </span>][<span class="string">logstash.pipeline        </span>] Starting pipeline &#123;"id"=&gt;"main", "pipeline.workers"=&gt;4, "pipeline.batch.size"=&gt;20000, "pipeline.batch.delay"=&gt;3, "pipeline.max_inflight"=&gt;80000&#125;</span><br><span class="line">[<span class="string">2017-06-09T15:11:09,088</span>][<span class="symbol">WARN </span>][<span class="string">logstash.pipeline        </span>] CAUTION: Recommended inflight events max exceeded! Logstash will run with up to 80000 events in memory in your current configuration. If your message sizes are large this may cause instability with the default heap size. Please consider setting a non-standard heap size, changing the batch size (currently 20000), or changing the number of pipeline workers (currently 4)</span><br><span class="line">[<span class="string">2017-06-09T15:11:09,109</span>][<span class="symbol">INFO </span>][<span class="string">logstash.pipeline        </span>] Pipeline main started</span><br><span class="line">[<span class="string">2017-06-09T15:11:09,154</span>][<span class="symbol">INFO </span>][<span class="string">logstash.agent           </span>] Successfully started Logstash API endpoint &#123;:port=&gt;9601&#125;</span><br><span class="line">[<span class="string">2017-06-09T15:11:18,651</span>][<span class="symbol">INFO </span>][<span class="string">logstash.inputs.jdbc     </span>] (10.100000s) SELECT car.car<span class="emphasis">_id AS car_</span>id,</span><br><span class="line">...</span><br><span class="line">[<span class="string">2017-06-09T15:15:49,619</span>][<span class="symbol">WARN </span>][<span class="string">logstash.agent           </span>] stopping pipeline &#123;:id=&gt;"main"&#125;</span><br></pre></td></tr></table></figure></p>
<p>单次全量耗时4分30秒，docker容器显示的系统负载峰值（使用命令<code>docker stats</code>）：<br><img src="/image/2017-06-09-18-27-35.jpg" alt=""><br>对应的系统负载峰值（使用命令<code>vmstat -n 1</code>）：<br><img src="/image/@iZ23qcuujszZ::tmp 2017-06-09 16-16-37.png" alt=""><br>基本已经榨干了ecs的所有计算资源。<br>尝试更多配置：</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>-w 4 -b 60000 -u 3</td>
<td>4分25s</td>
</tr>
<tr>
<td>-w 6 -b 20000 -u 3</td>
<td>4分13s</td>
</tr>
</tbody>
</table>
<p>可以发现不管是提升worker数还是提升单次提交的数据，都无法继续提升性能，基本是这台2核ECS的极限了，而且同时ES的集群（2台2核4g）也出现了CPU的负载峰值：</p>
<p><img src="/image/search_load.png" alt=""></p>
<p>看来在现有的计算资源之下，我们只能暂且容忍这么长的全量时间了，后面继续调整ES的配置，看看会不会有提升。</p>

      
    </div>

    

    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>给我买杯咖啡吧～</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/image/alipay.png" alt="Suclogger Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Spring-Boot相关及Dubbo集成/" rel="next" title="Spring-Boot相关及Dubbo集成">
                <i class="fa fa-chevron-left"></i> Spring-Boot相关及Dubbo集成
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ES使用filebeat收集nginx日志/" rel="prev" title="ES使用filebeat收集nginx日志">
                ES使用filebeat收集nginx日志 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Suclogger</p>
              <p class="site-description motion-element" itemprop="description">人生如逆旅，我亦是行人</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">48</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">29</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#背景"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#现象"><span class="nav-number">2.</span> <span class="nav-text">现象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理"><span class="nav-number">3.</span> <span class="nav-text">处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tomcat启动慢"><span class="nav-number">3.1.</span> <span class="nav-text">Tomcat启动慢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建索引慢：数据库"><span class="nav-number">3.2.</span> <span class="nav-text">创建索引慢：数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建索引慢：EL"><span class="nav-number">3.3.</span> <span class="nav-text">创建索引慢：EL</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Suclogger</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
