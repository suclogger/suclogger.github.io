---
title: 通过Wireshark看MIM攻击
comments: true
toc: true
categories:
  - 编程
tags:
  - 加密
  - 安全
date: 2016-10-18 22:41:14
---
<!-- abstract -->
<!-- 开始正文 -->
本文中，服务端IP地址是`120.55.246.173`，移动端（我的手机）的IP地址是`192.168.1.226`，中间人（我的电脑）的IP地址是`192.168.1.158`，电脑通过Charles监听8888端口，转发移动端发来的数据包。

## 正常的HTTPS通信过程

![](/image/2016-10-18-23-12-10.png)
正如在上文[应用接口的安全方案设计（二）](http://suclogger.tech/2016/10/14/%E5%BA%94%E7%94%A8%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1%EF%BC%88%E4%BA%8C%EF%BC%89/) 中分析的，是否存在MIM攻击关键在于客户端接收到的证书，是否是服务端下发的原始证书。
着重看编号`156`和`158`两个包。
`156`携带着服务端下发的原始证书信息：
![](/image/2016-10-18-23-35-55.png)
`158`是Charles处理后发送给客户端的包：

![](/image/2016-10-18-23-37-13.png)
可以看到传递的证书是一致的，意味着这个HTTPS通信是安全的。

## MIM攻击下的HTTPS通信过程
`276`号包表示服务端下发给Charles合法的证书：
![](/image/2016-10-18-23-38-14.png)
`352`号包表示Charles传递自己的证书给客户端：

![](/image/2016-10-18-23-41-52.png)
Wireshark已经贴心的给我们加上了黄色的警告提示，这个证书已经由原来由wosign签发的证书被替换成了Charles的证书：
![](/image/2016-10-18-23-43-15.jpg)
如果客户端接收了Charles的证书，整个通信内容就都暴露在Charles中了。



